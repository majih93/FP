# 현실에서의 함수형 사고

키워드

- 계층형 설계 (stratified design)
- 타임라인 다이어그램
- 일급 함수

## 파트1: 액션과 계산, 데이터

토니의 피자 가게에서 발생하는 이벤트들을 액션과 계산 그리고 데이터로 분류해보자.

여러 번 강조되었지만, 이 책에서 세 가지를 구분하는 이유는 쉽게 다룰 수 있는 부분과 조심히 다뤄야 하는 부분을 구분하기 위함이다.

**액션**

- 반죽 펴기
- 피자 배달
- 재료 주문

**계산**

- 조리법에 나온 것을 두 배로 만들기
- 쇼핑 목록 결정

**데이터**

- 고객 주문
- 영수증
- 조리법

## 변경 가능성에 따라 코드 나누기

변경 가능성을 기준으로 코드를 분류한다. 계층적으로 자주 바뀌지 않는 것을 아래로, 자주 바뀌는 것을 위쪽으로 배치해서 보는 것이다.

이 때, 각 계층은 그 아래에 있는 계층을 기반으로 만들어진다. 위쪽에 위치할 수록 의존성이 적어 더 쉽게 변경이 가능하다. 아래에 있는 코드는 의존성이 보다 많아 변경이 어렵지만, 자주 변경되지 않는다.

이렇게 계층적으로 코드를 나눌 때 보통 위에서부터 **비즈니스 규칙 - 도메인 규칙 - 기술 스택** 계층으로 분류한다.

## 파트2: 일급 추상

타임라인 다이어그램을 통해서 특정한 액션이 어떤 시간 순서에 따라 실행되는지 알 수 있음 -> 액션은 실행되는 횟수와 시점이 중요하니까!

이런 타임라인 여러 개가 한꺼번에 함께 동작해서 특정한 결과를 도출해야되는 시스템은 어떻게 잘 동작하게 만들 수 있을까?

하나의 작업을 여러 시스템에 분배해서 수행하는 것은 일종의 분산 시스템이다. 하나의 목표를 위해 일을 나눠서 수행하는 시스템끼리 타임라인을 서로 맞추지 않았다면 분산 시스템의 작업은 예측 불가능한 순서로 실행된다.

예를 들어, 피자를 만드는 작업을 3개의 로봇에게 작업 단위를 나눠서 할당하는 상황을 생각해보자.

로봇1 - 반죽 만들기
로봇2 - 치즈 갈기
로봇3 - 소스 만들기

만약에 반죽이 다 만들어지지 않았는데 로봇3이 소스를 다 만들었다고 반죽을 펴서 소스를 바르려고 시도한다면 이미 망한 피자겠지?

이처럼 타임라인이 서로 맞지 않는 시스템들끼리 돌아가는 상황에서는 원하는 결과가 일관되게 도출될것이라는 보장이 없다.

타임라인들이 필요할 때 서로 시간을 맞출 수 있도록 하는 작업을 **커팅**이라고 한다.

타임라인 커팅을 타임라인 다이어그램으로 잘 표시하면 전체적인 작업의 실행 순서 및 구조를 더 쉽게 파악할 수 있어 도움이 된다.
